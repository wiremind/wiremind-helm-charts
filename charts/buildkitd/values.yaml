image:
  repository: moby/buildkit
  pullPolicy: IfNotPresent
  tag: ""

imagePullSecrets: []
# - name: "image-pull-secret"

# User 1000 is used in official images
user:
  name: "user"
  uid: 1000
  gid: 1000

nameOverride: ""
fullnameOverride: ""

resources: {}
#  requests:
#    cpu: "100m"
#    memory: 1Gi
#  limits:
#    cpu: "1"
#    memory: 2Gi

extraArgs: []

replicaCount: 1

# StatefulSet update strategy
updateStrategy:
  type: RollingUpdate
  # rollingUpdate:
  #   partition: 0
  #   maxUnavailable: 1

env: {}

persistence:
  size: "1Gi"
  storageClass: ""
  accessModes: "ReadWriteOnce"

priorityClassName: ""

nodeSelector: {}

tolerations: []

affinity: {}

## Topology spread constraints for pod distribution
## Ref: https://kubernetes.io/docs/concepts/workloads/pods/pod-topology-spread-constraints/
topologySpreadConstraints: []
# Example topology spread constraints:
# - maxSkew: 1
#   topologyKey: topology.kubernetes.io/zone
#   whenUnsatisfiable: ScheduleAnyway
#   labelSelector:
#     matchLabels:
#       app.kubernetes.io/name: buildkitd
#       app.kubernetes.io/instance: RELEASE-NAME
# - maxSkew: 1
#   topologyKey: kubernetes.io/hostname
#   whenUnsatisfiable: DoNotSchedule
#   labelSelector:
#     matchLabels:
#       app.kubernetes.io/name: buildkitd
#       app.kubernetes.io/instance: RELEASE-NAME

podDisruptionBudget:
  enabled: false
  # minAvailable: 1
  # maxUnavailable: 1

config:
  debug: false
  trace: false
  logFormat: "text"
  port: 12345
  debugPort: 6060
  otel:
    resourceAttr: ""
    common:
      protocol: "grpc"
      endpoint: ""
      headers: ""
      compression: "gzip"
      timeout: 10000
      insecure: false
    metrics:
      exporter: "none"
      export_interval: 10000
      export_timeout: 10000
      endpoint: ""
      headers: ""
      compression: "gzip"
      timeout: 10000
      insecure: false
    traces:
      endpoint: ""
      headers: ""
      compression: "gzip"
      timeout: 10000
      insecure: false
  gc:
    enabled: true
    keepstoragePercentage: 0.90
    policies:
      - keepDuration: '"48h"'
        keepBytes: '"100MB"'
        filters: ['"type==source.local"', '"type==exec.cachemount"', '"type==source.git.checkout"']
      - all: true
        keepDuration: ""
        keepBytes: ""
        filters: []
  workerOci:
    enabled: true
    selinux: false
    platforms: ['"linux/amd64"']
    snapshotter: "auto"
    maxParallelism: ""
  history:
    maxAge: 172800
    maxEntries: 50
  # Registry mirror configuration
  # See: https://docs.docker.com/build/buildkit/toml-configuration/
  registries: []
  # Example:
  # registries:
  #   - registry: "docker.io"
  #     mirrors:
  #       - "yourmirror.local:5000"
  #       - "core.harbor.domain/proxy.docker.io"
  #     http: false
  #     insecure: false
  #     ca: []
  #     keypairs: []
  #       # - key: "/etc/config/key.pem"
  #       #   cert: "/etc/config/cert.pem"

livenessProbe:
  initialDelaySeconds: 5
  periodSeconds: 30
  timeoutSeconds: 5
  successThreshold: 1
  failureThreshold: 5

readinessProbe:
  initialDelaySeconds: 5
  periodSeconds: 30
  timeoutSeconds: 5
  successThreshold: 1
  failureThreshold: 5

startupProbe:
  retries: 60

extraSecurityContext: {}

extraPodSecurityContext:
  appArmorProfile:
    type: Unconfined

lifecycle: {}

terminationGracePeriodSeconds: 30

## Metrics configuration for Prometheus monitoring
metrics:
  ## ServiceMonitor configuration for Prometheus Operator
  serviceMonitor:
    ## Enable ServiceMonitor creation
    enabled: false

    ## Namespace where ServiceMonitor should be created
    ## If not set, uses the same namespace as the chart
    namespace: ""

    ## Additional labels for ServiceMonitor
    additionalLabels: {}
      # prometheus: kube-prometheus
      # release: prometheus

    ## ServiceMonitor annotations
    annotations: {}

    ## Scrape interval for Prometheus
    interval: 30s

    ## Scrape timeout for Prometheus
    scrapeTimeout: 10s

    ## Path to scrape metrics from (buildkitd debug endpoint)
    path: /metrics

    ## Port name to scrape metrics from (references service port name)
    portName: debug

    ## Metric relabeling configurations
    metricRelabelings: []
      # - sourceLabels: [__name__]
      #   regex: 'buildkit_.*'
      #   action: keep

    ## Relabeling configurations
    relabelings: []
      # - sourceLabels: [__meta_kubernetes_pod_name]
      #   separator: ;
      #   regex: ^(.*)$
      #   targetLabel: instance
      #   replacement: $1
      #   action: replace

    ## HonorLabels chooses the metric's labels on collisions with target labels
    honorLabels: false

    ## HonorTimestamps controls whether Prometheus respects the timestamps present in scraped data
    honorTimestamps: true

podLabels: {}

podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "6060"
